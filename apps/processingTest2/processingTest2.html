<script src="processing-1.4.1.js"></script>
<script type="text/processing" data-processing-target="mycanvas">
Boolean drawRed = false;
Boolean drawBlue = true;  
int count = 0;

void setup()
{
  size(1400,700);
  background(125.0);
  fill(255);
  
  PFont fontA = loadFont("courier");
  textFont(fontA, 14); 
  
  readyRedraw = true;  
}

void draw(){

    if(readyRedraw)
    {
        if( pointerPressed ){
            mousePressed();
            pointerPressed = false;
        }

        background(125.0);
        if( drawRed )
            fill( 255.0, 0.0, 0.0);
        else
            fill( 0.0, 0.0, 255.0 );
        rect(0, 0, 700, 700);
    
        fill(255.0);
        text("Hello Web! " + pointerX + " " + pointerY ,20,20);    
        text("Click Here", 750, 20);
        readyRedraw = false;
        
    }
    
}

void mousePressed()
{
    setMouseToPointer(); 
    if( mouseX > 700 ){
        drawRed = !drawRed;
        drawBlue = !drawBlue; 
    } 
    sendMsg("pointer event at x= " + mouseX + " y= " + mouseY);
}

void setMouseToPointer() 
{
    mouseX = pointerX;
    mouseY = pointerY;
}

<!-- 
void setMouseToPointer(double pointerX, double pointerY) 
{
    mouseX = pointerX;
    mouseY = pointerY;
}
 -->

<!-- 
void pointerPressed(ptrX, ptrY)
{
    mouseX = 800; //ptrX;
    mouseY = ptrY; 
    mousePressed();
}
 -->
    

</script>
<canvas id="mycanvas"></canvas>
<script type="text/javascript" src="../../lib/socket.io.min.js"></script>
<script type="application/javascript">
var url;
var socket;

url = window.location.origin;
socket = io.connect(url);
console.log("Connected to server: ", url);

//--------- LISTEN TO EVENTS FROM WEBSAGE---------------
var pointerX = 0;
var pointerY = 0; 
var pointerPressed = false; 
var readyRedraw = false; 


window.addEventListener("message", receiveMessage, false);
function receiveMessage(event)
{
//   if (event.origin !== "http://example.org:8080")  //may add this later for security concerns
//     return;
    if (event.data.indexOf( 'pointerClick') != -1) {
        var tokens = event.data.split(' ');
        pointerX = tokens[2];
        pointerY = tokens[4]; 
        pointerPressed = true;     
        readyRedraw = true;     
    }
    if (event.data.indexOf( 'pointerMove') != -1) {
        var tokens = event.data.split(' ');
        pointerX = tokens[2];
        pointerY = tokens[4]; 
        readyRedraw = true;     
    } 

}


//--------- SEND EVENTS TO WEBSAGE ---------------
function sendMsg(msg){
    
    socket.emit("pointerEventRecorded", msg);
    //window.parent.postMessage('sendingMsg: ' + msg, '*');  
//     
//         pointerX = 800;
//         pointerY = 100; 
//         pointerPressed = true;     
//         readyRedraw = true;  
}

</script>






// var pointerX = 0;
// var pointerY = 0; 
// var pointerPressed = false; 
// var readyRedraw = false; 
// window.onmessage = function(e){
//     var processingInstance = Processing.getInstanceById('mycanvas');
//     if (e.data.indexOf( 'pointerClick') != -1) {
//         var tokens = e.data.split(' ');
//         pointerX = tokens[2];
//         pointerY = tokens[4]; 
//         pointerPressed = true;
//         processingInstance.setMouseToPointer(pointerX, pointerY); 
//         processingInstance.mousePressed();
//         readyRedraw = true;
//     }
    
    
//};
<!-- 

<script type="application/javascript">
        var myX = -1;
        var myY = -1;
        var ptrClick = function (x, y) {
           x = myX;
           y = myY;
        };
</script>
 -->

